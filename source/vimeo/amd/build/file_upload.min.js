define("mediatimesrc_vimeo/file_upload",["exports","core/ajax","core/config","core/log","core/notification"],(function(_exports,_ajax,_config,_log,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_ajax=_interopRequireDefault(_ajax),_config=_interopRequireDefault(_config),_log=_interopRequireDefault(_log),_notification=_interopRequireDefault(_notification);const upload=async resource=>{const file=document.querySelector('input[name="videofile"]').files[0],url=new URL(_config.default.wwwroot+"/admin/tool/mediatime/index.php");let response;url.searchParams.set("id",resource.id);do{const request=new Request(resource.uploadurl,{body:file,headers:{"Tus-Resumable":"1.0.0","Upload-Offset":String(0),"Content-Type":"application/offset+octet-stream"},method:"PATCH"});response=await fetch(request),document.querySelector(".progress").style.width=response.headers.get("Upload-Offset")/file.size*100+"%",_log.default.debug(response.headers.get("Upload-Offset"))}while(response.headers.get("Upload-Offset")<file.size);window.location.href=url};var _default={init:function(){document.body.removeEventListener("click",this.handleClick),document.body.addEventListener("click",this.handleClick)},handleClick:function(e){if(e.target.closest('button[name="upload"]')){const file=document.querySelector('input[name="videofile"]').files[0];e.preventDefault(),_ajax.default.call([{args:{filesize:Number(file.size),description:document.querySelector('input[name="description"]').value,name:document.querySelector('input[name="name"]').value,tags:document.querySelector('input[name="tags"]').value,title:document.querySelector('input[name="title"]').value},contextid:1,done:upload,fail:_notification.default.exception,methodname:"mediatimesrc_vimeo_create_token"}]),_log.default.debug(file.size)}}};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=file_upload.min.js.map