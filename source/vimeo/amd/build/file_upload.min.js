define("mediatimesrc_vimeo/file_upload",["exports","core/ajax","core/config","core/log","core/notification"],(function(_exports,_ajax,_config,_log,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_ajax=_interopRequireDefault(_ajax),_config=_interopRequireDefault(_config),_log=_interopRequireDefault(_log),_notification=_interopRequireDefault(_notification);const upload=async resource=>{const file=document.querySelector('input[name="videofile"]').files[0],url=new URL(_config.default.wwwroot+"/admin/tool/mediatime/index.php");let offset=0;url.searchParams.set("id",resource.id);do{const request=new Request(resource.uploadurl,{body:file.slice(Number(offset),Number(offset)+134217728),headers:{"Tus-Resumable":"1.0.0","Upload-Offset":String(offset),"Content-Type":"application/offset+octet-stream"},method:"PATCH"}),response=await fetch(request).catch((e=>(_log.default.debug(e),new Promise((resolve=>setTimeout(resolve,1e3))))));response&&response.ok&&(offset=response.headers.get("Upload-Offset")),document.querySelector(".progress").style.width=offset/file.size*100+"%"}while(offset<file.size);window.location.href=url};var _default={init:function(){document.body.removeEventListener("click",this.handleClick),document.body.addEventListener("click",this.handleClick)},handleClick:function(e){if(e.target.closest('button[name="upload"]')){const file=document.querySelector('input[name="videofile"]').files[0];e.preventDefault(),_ajax.default.call([{args:{filesize:Number(file.size),contextid:document.querySelector('input[name="contextid"]').value,description:document.querySelector('input[name="description"]').value,name:document.querySelector('input[name="name"]').value,parenturi:"iii",tags:document.querySelector('input[name="tags"]').value,title:document.querySelector('input[name="title"]').value},contextid:document.querySelector('input[name="contextid"]').value,done:upload,fail:_notification.default.exception,methodname:"mediatimesrc_vimeo_create_token"}])}}};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=file_upload.min.js.map