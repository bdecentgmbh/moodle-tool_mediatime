{"version":3,"file":"file_upload.min.js","sources":["../src/file_upload.js"],"sourcesContent":["var upload;\n\nimport * as tus from 'mediatimesrc_streamio/tus';\nimport Log from 'core/log';\nimport cfg from 'core/config';\n\nconst options = {\n    endpoint: cfg.wwwroot + '/api/v1/videos/tus',\n    metadata: {},\n    onError: Log.debug,\n    onProgress: function(bytesUploaded, bytesTotal) {\n        document.querySelectorAll('.progress').forEach(indicator => {\n            indicator.style.width = (bytesUploaded / bytesTotal * 100) + '%';\n        });\n    },\n    onSuccess: function() {\n        document.getElementById('upload_resource_form').submit();\n        Log.debug(upload.url);\n    }\n};\n\nexport default {\n    init: function(token) {\n        options.metadata.uploadtoken = token;\n        document.body.removeEventListener('click', this.handleClick);\n        document.body.addEventListener('click', this.handleClick);\n    },\n\n    handleClick: function(e) {\n        const button = e.target.closest('button[name=\"upload\"]');\n        if (button) {\n            const file = document.querySelector('input[name=\"streamiofile\"]').files[0];\n            e.preventDefault();\n            options.metadata.filename = file.name;\n            options.metadata.filetype = file.type;\n            Log.debug(options);\n            Log.debug(tus);\n\n            upload = new tus.Upload(file, options);\n            upload.start();\n        }\n    }\n};\n"],"names":["upload","options","endpoint","wwwroot","metadata","onError","Log","debug","onProgress","bytesUploaded","bytesTotal","document","querySelectorAll","forEach","indicator","style","width","onSuccess","getElementById","submit","url","init","token","uploadtoken","body","removeEventListener","this","handleClick","addEventListener","e","target","closest","file","querySelector","files","preventDefault","filename","name","filetype","type","tus","Upload","start"],"mappings":"0fAAIA,qxBAMEC,QAAU,CACZC,2DAAcC,QAAU,qBACxBC,SAAU,GACVC,QAASC,aAAIC,MACbC,WAAY,SAASC,cAAeC,YAChCC,SAASC,iBAAiB,aAAaC,SAAQC,YAC3CA,UAAUC,MAAMC,MAASP,cAAgBC,WAAa,IAAO,QAGrEO,UAAW,WACPN,SAASO,eAAe,wBAAwBC,sBAC5CZ,MAAMP,OAAOoB,oBAIV,CACXC,KAAM,SAASC,OACXrB,QAAQG,SAASmB,YAAcD,MAC/BX,SAASa,KAAKC,oBAAoB,QAASC,KAAKC,aAChDhB,SAASa,KAAKI,iBAAiB,QAASF,KAAKC,cAGjDA,YAAa,SAASE,MACHA,EAAEC,OAAOC,QAAQ,yBACpB,OACFC,KAAOrB,SAASsB,cAAc,8BAA8BC,MAAM,GACxEL,EAAEM,iBACFlC,QAAQG,SAASgC,SAAWJ,KAAKK,KACjCpC,QAAQG,SAASkC,SAAWN,KAAKO,kBAC7BhC,MAAMN,sBACNM,MAAMiC,MAEVxC,OAAS,IAAIwC,IAAIC,OAAOT,KAAM/B,UACvByC"}